<%- include('../common/head.ejs') %>
    
   <div class="wrapper order_wrapper">
      <%- include('../common/top_nav.ejs') %>
         <div class="content order_content">
            <div class="frame">
               <div class="left_bar">
                   <ul>
                     <li class="left_profile_li">
                        <%if(img=='false'){%>
                        <img src="/uploads/profiles/altimage-removebg-preview.png" alt="">
                        <%}else{%>
                            <img src="/uploads/profiles/<%=profiledata.userImage%>" alt="">
                            <%}%>    
                        <h3 style="color: white;">HELLO</h3>
                    </li>
                       <li onclick="location.href='/account/address' " class=""><i class="bi bi_left_bar bi-person-circle"></i>Profile</li>
                       <li onclick="location.href='/account/update_password' " class=""><i class="bi bi_left_bar bi-shield-lock-fill"></i>Update Password</li>
                       <li onclick="location.href='/account/orders' " class=""><i class="bi bi_left_bar bi-gift-fill"></i>Orders</li>
                       <li onclick="location.href='/cart'"><i class="bi bi_left_bar bi-cart-fill"></i>Cart</li>
                       <li onclick="location.href='/wishlist' " ><i class="bi bi_left_bar bi-heart-fill"></i>Wishlist</li>
                       <li onclick="location.href='/account/aboutus' " class=""><i class="bi bi_left_bar bi-info-circle-fill"></i>About Us</li>
                       <li onclick="location.href='/account/contactus' " class=""><i class="bi bi_left_bar bi-telephone-fill"></i>Contact Us</li>
                   </ul>
               </div>
               </div>
            <div class="right_content">
               <%orders.forEach((order)=>{ %>
                  
               <table class="row<%=order._id %>" style="margin-bottom: 20px;">
                  <thead>
                     <tr>
                        <th style="width: 30%;">PRODUCT</th>
                        <th style="width: 15%;">ORDER ID</th>
                        <th style="width: 10%;">AMOUNT</th>
                        <th style="width: 10%;">ORDER DATE</th>
                        <th style="width: 10%;">STATUS</th>
                        <th style="width: 8%;"></th>
                     </tr>
                  </thead>
               
                  <tbody>
                  <tr class="td_tr" onclick="window.location.href='/user/orderopen?id=<%=order._id %>'" >
                     
                     <td class="product_td"  >
                        <div class="img_section"><img src="/uploads/products/<%=order.productsid[0].productid.productImage[0] %>" style="height: 6rem; width: 5rem;" alt=""></div>
                        <div class="product_details">
                           <p class="order_product_name"><%=order.productsid[0].productid.productName %></p>
                           <p class="order_size">Size : <span style="font-size: 1.1rem;"><%=order.productsid[0].size %></span></p>
                           <p class="order_color">Color : <span><%=order.productsid[0].color %></span></p>
                        </div>
                     </td>
                     <td><%=order._id %></td>
                     <td style="font-family: 'Poppins',sans-serif; font-weight: 600; color: rgba(255, 0, 0, 0.748);"><i class="bi bi-currency-rupee"></i><%=order.productsid[0].productid.discount %></td>
                     <%const date=order.orderdate.toISOString().substring(0, 10)%>
                     <td style="font-family: 'Poppins',sans-serif; font-weight: 600; color: rgba(0, 0, 0, 0.748);"><%=date %></td>
                     <td class="status delivered"><%=order.status %></td>
                     <td ><button style="height: 20%;width: 70%; font-size: small;font-weight: bold;background-color: rgb(32, 100, 9);color: white;border: none;border-radius: 5px; cursor: pointer;"><a href="javascript:void(0);"  style="text-decoration: none ;color: aliceblue;" onclick="confirmDelete('<%=order._id %>','<%=order.productsid[0].productid.productName %>') ;">Cancel</button></td>

                  </tr>
                  </tbody>

               </table>
               
               <% }); %>
               
            </div>
            
         </div>
   </div>
   <%- include('../common/footer.ejs') %>


   <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

       
   <script>
       function confirmDelete(id,name) {
           Swal.fire({
               title: "Are you sure?",
               text: "You won't be able to revert this!",
               icon: "warning",
               showCancelButton: true,
               confirmButtonColor: "#3085d6",
               cancelButtonColor: "#d33",
               confirmButtonText: "Yes, cancel it!"
           }).then(async(result) => {
               if (result.isConfirmed) {
                   const response=await fetch(`/user/deleteorder?id=${id}`,{method:"delete"});
                   if (!response.ok) {
                       throw new Error("Error deleting product: " + response.statusText);
                   }
                   const result = await response.json();
                   if (result.success) {
                       Swal.fire({
                           title: "Cancelled!",
                           text: `${name} has been cancelled.`,
                           icon: "success"
                       });
                       document.querySelector('.row'+id).remove()
                   } else {
                       message.innerHTML = result.error || "Unknown error";
                   }
               }
           });
      }
  
  
  </script>

<%- include('../common/end.ejs') %>